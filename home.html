<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JLMSï½œæ•™æé¸æ“‡</title>
  <link rel="stylesheet" href="style/main.css" />
</head>
<body>
  <div class="main-container">
    <h1>ğŸ“˜ RÃ©pÃ©tition des phrases â€“ Chinois de la vie quotidienne</h1>

    <!-- æ›¸å†Šé¸æ“‡ -->
    <label for="bookSelect">é¸æ“‡æ›¸å†Šï¼š</label>
    <select id="bookSelect">
      <option value="1">Book 1</option>
      <option value="2">Book 2</option>
      <option value="3">Book 3</option>
      <option value="4">Book 4</option>
    </select>

    <!-- èª²æ¬¡é¸æ“‡ -->
    <label for="lessonSelect">é¸æ“‡èª²æ¬¡ï¼š</label>
    <select id="lessonSelect">
      <!-- èª²æ¬¡é¸é …æœƒæ ¹æ“šæ›¸å†Šè‡ªå‹•ç”¢ç”Ÿ -->
    </select>

    <div id="sentenceList" class="sentence-area">
      <!-- ä¾‹å¥æœƒå‡ºç¾åœ¨é€™è£¡ -->
    </div>
  </div>

  <script>
    const bookSelect = document.getElementById("bookSelect");
    const lessonSelect = document.getElementById("lessonSelect");
    const sentenceList = document.getElementById("sentenceList");

    // æ›¸å†Š â†’ å°æ‡‰èª²æ¬¡å€é–“
    const lessonMap = {
      1: [1, 5],
      2: [6, 10],
      3: [11, 15],
      4: [16, 20],
    };

    bookSelect.addEventListener("change", updateLessonOptions);
    lessonSelect.addEventListener("change", loadLesson);

    // åˆå§‹åŒ–é é¢
    updateLessonOptions();

    function updateLessonOptions() {
      const book = bookSelect.value;
      const [start, end] = lessonMap[book];
      lessonSelect.innerHTML = "";
      for (let i = start; i <= end; i++) {
        const opt = document.createElement("option");
        opt.value = "L" + i;
        opt.textContent = "L." + i;
        lessonSelect.appendChild(opt);
      }
      loadLesson(); // é¸å–®æ”¹è®Šæ™‚è‡ªå‹•è¼‰å…¥
    }

    async function loadLesson() {
      const lesson = lessonSelect.value;
      sentenceList.innerHTML = "<p>è¼‰å…¥ä¸­...</p>";
      try {
        const res = await fetch(`data/${lesson}.json`);
        const data = await res.json();
        renderSentences(data);
      } catch (err) {
        sentenceList.innerHTML = "<p>âŒ æ‰¾ä¸åˆ°é€™èª²çš„è³‡æ–™</p>";
      }
    }

    function renderSentences(sentences) {
      sentenceList.innerHTML = "";
      sentences.forEach((item) => {
        const card = document.createElement("div");
        card.className = "sentence-card";

        const hanzi = document.createElement("div");
        hanzi.className = "sentence-text";
        hanzi.textContent = item.hanzi;
        hanzi.onclick = () => playBrowserVoice(hanzi);

        const pinyin = document.createElement("div");
        pinyin.className = "pinyin-text";
        pinyin.textContent = item.pinyin;

        const btn = document.createElement("button");
        btn.className = "audio-button";
        btn.textContent = "ğŸ™ æ’­æ”¾è‡ªç„¶èªéŸ³";
        btn.onclick = () => alert("é€™è£¡æœƒä¸²æ¥è‡ªç„¶èªéŸ³ API");

        card.appendChild(hanzi);
        card.appendChild(pinyin);
        card.appendChild(btn);
        sentenceList.appendChild(card);
      });
    }

    function playBrowserVoice(el) {
      const text = el.textContent;
      const msg = new SpeechSynthesisUtterance(text);
      msg.lang = "zh-TW";

      // æ¸…é™¤å…¶ä»–å¥å­çš„é«˜äº®
      document.querySelectorAll(".sentence-text").forEach(e => e.classList.remove("playing"));
      el.classList.add("playing");

      speechSynthesis.speak(msg);
    }
  </script>
</body>
</html>
